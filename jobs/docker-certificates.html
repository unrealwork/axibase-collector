<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Collector | Docker Certificates</title>
    <meta name="description" content="User manual and API reference for AxibaseÂ® Time Series Database">
    <link rel="shortcut icon" href="/axibase-collector/favicon.ico">
    
    <link rel="stylesheet" href="/axibase-collector/assets/css/119.styles.64c5d684.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/axibase-collector/" class="home-link router-link-active"><img src="/axibase-collector/images/axibase_logo_green.gif" class="logo"><span class="site-name can-hide">
      Collector
    </span></a><div class="links"><nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Jobs</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/aws.html" class="nav-link">AWS</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/docker.html" class="nav-link">Docker</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/file.html" class="nav-link">File</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/http.html" class="nav-link">HTTP</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/icmp.html" class="nav-link">ICMP</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/jdbc.html" class="nav-link">JDBC</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/jmx.html" class="nav-link">JMX</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/json.html" class="nav-link">JSON</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/kafka.html" class="nav-link">Kafka</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/ovpm.html" class="nav-link">OVPM</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/pi.html" class="nav-link">PI</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/snmp.html" class="nav-link">SNMP</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/socrata.html" class="nav-link">Socrata</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/tcp.html" class="nav-link">TCP</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Data Sources</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/jdbc-data-source.html" class="nav-link">Database</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/http-pool.html" class="nav-link">HTTP Pool</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/kafka-consumer.html" class="nav-link">Kafka Consumer</a></li></ul></div></div><div class="nav-item"><a href="/axibase-collector/jobs/examples/" class="nav-link">Examples</a></div><!----></nav><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Jobs</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/aws.html" class="nav-link">AWS</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/docker.html" class="nav-link">Docker</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/file.html" class="nav-link">File</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/http.html" class="nav-link">HTTP</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/icmp.html" class="nav-link">ICMP</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/jdbc.html" class="nav-link">JDBC</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/jmx.html" class="nav-link">JMX</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/json.html" class="nav-link">JSON</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/kafka.html" class="nav-link">Kafka</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/ovpm.html" class="nav-link">OVPM</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/pi.html" class="nav-link">PI</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/snmp.html" class="nav-link">SNMP</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/socrata.html" class="nav-link">Socrata</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/tcp.html" class="nav-link">TCP</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Data Sources</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/jdbc-data-source.html" class="nav-link">Database</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/http-pool.html" class="nav-link">HTTP Pool</a></li><li class="dropdown-item"><!----><a href="/axibase-collector/jobs/kafka-consumer.html" class="nav-link">Kafka Consumer</a></li></ul></div></div><div class="nav-item"><a href="/axibase-collector/jobs/examples/" class="nav-link">Examples</a></div><!----></nav><ul class="sidebar-links"><li><a href="/axibase-collector/" class="sidebar-link">Axibase Collector</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Installation</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Updating</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Administration</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Job's Configuration</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Automation</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h1 id="docker-certificates"><a href="#docker-certificates" aria-hidden="true" class="header-anchor">#</a> Docker Certificates</h1><p>Protecting the Docker daemon socket with OpenSSL.
Make sure you replace <strong><code>$HOST</code></strong> in the following examples with the DNS name of the target Docker host.</p><blockquote><p>Credit: <a href="https://docs.docker.com/engine/security/https/#create-a-ca-server-and-client-keys-with-openssl" target="_blank" rel="noopener noreferrer">https://docs.docker.com/engine/security/https/#create-a-ca-server-and-client-keys-with-openssl</a></p></blockquote><h2 id="generate-private-and-public-keys-for-a-ca-certificate-authority"><a href="#generate-private-and-public-keys-for-a-ca-certificate-authority" aria-hidden="true" class="header-anchor">#</a> Generate Private and Public Keys for a CA (Certificate Authority)</h2><p>Create a directory for certificate files:</p><pre class="language-text"><code>mkdir /home/ubuntu/certs
cd /home/ubuntu/certs
</code></pre><p>Generate a private key:</p><pre class="language-text"><code>openssl genrsa -aes256 -out ca-key.pem 4096
</code></pre><p>Generate a certificate request using the pass phrase for <code>ca-key.pem</code>:</p><pre class="language-text"><code>openssl req -new -x509 -days 365 -key ca-key.pem -sha256 -out ca.pem
</code></pre><p>Fill out the fields.</p><p>Make sure you set Common Name to the DNS name of the Docker host: <strong><code>$HOST</code></strong></p><pre class="language-properties"><code><span class="token attr-name">Country</span> <span class="token attr-value">Name (2 letter code) [AU]:US</span>
<span class="token attr-name">State</span> <span class="token attr-value">or Province Name (full name) [Some-State]:CA</span>
<span class="token attr-name">Locality</span> <span class="token attr-value">Name (eg, city) []:Cupertino</span>
<span class="token attr-name">Organization</span> <span class="token attr-value">Name (eg, company) [Internet Widgits Pty Ltd]:MyCompany</span>
<span class="token attr-name">Organizational</span> <span class="token attr-value">Unit Name (eg, section) []:</span>
<span class="token attr-name">Common</span> <span class="token attr-value">Name (e.g. server FQDN or YOUR name) []:$HOST</span>
<span class="token attr-name">Email</span> <span class="token attr-value">Address []:</span>
</code></pre><h2 id="create-a-server-key-and-certificate-signing-request-csr"><a href="#create-a-server-key-and-certificate-signing-request-csr" aria-hidden="true" class="header-anchor">#</a> Create a Server Key and Certificate Signing Request (CSR)</h2><pre class="language-text"><code>openssl genrsa -out server-key.pem 4096
</code></pre><pre class="language-text"><code>openssl req -subj &quot;/CN=$HOST&quot; -sha256 -new -key server-key.pem -out server.csr
</code></pre><h2 id="sign-the-public-key-with-our-ca"><a href="#sign-the-public-key-with-our-ca" aria-hidden="true" class="header-anchor">#</a> Sign the Public Key with our CA</h2><p>TLS connections need to be specified when creating the certificate, as they can be made via the IP address as well as the DNS name. For example, to allow connections
using <code>10.10.10.20</code> and <code>127.0.0.1</code>:</p><pre class="language-text"><code>echo subjectAltName = IP:10.10.10.20,IP:127.0.0.1 &gt; extfile.cnf
</code></pre><pre class="language-text"><code>openssl x509 -req -days 365 -sha256 -in server.csr -CA ca.pem -CAkey ca-key.pem \
      -CAcreateserial -out server-cert.pem -extfile extfile.cnf
</code></pre><h2 id="create-a-client-key-and-certificate-signing-request-for-client-authentication"><a href="#create-a-client-key-and-certificate-signing-request-for-client-authentication" aria-hidden="true" class="header-anchor">#</a> Create a Client Key and Certificate Signing Request for Client Authentication</h2><pre class="language-text"><code>openssl genrsa -out key.pem 4096
</code></pre><pre class="language-text"><code>openssl req -subj '/CN=client' -new -key key.pem -out client.csr
</code></pre><p>To make the key suitable for client authentication, create an extensions config file:</p><pre class="language-text"><code>echo extendedKeyUsage = clientAuth &gt; extfile.cnf
</code></pre><p>Sign the public key:</p><pre class="language-text"><code>openssl x509 -req -days 365 -sha256 -in client.csr -CA ca.pem -CAkey ca-key.pem \
      -CAcreateserial -out cert.pem -extfile extfile.cnf
</code></pre><p>After generating <code>cert.pem</code> and <code>server-cert.pem</code>, you can safely remove the
two certificate signing requests:</p><pre class="language-text"><code>rm -v client.csr server.csr
</code></pre><h2 id="set-permissions-to-private-keys"><a href="#set-permissions-to-private-keys" aria-hidden="true" class="header-anchor">#</a> Set Permissions to Private Keys</h2><p>With a default <code>umask</code> of 022, your secret keys will be <em>world-readable</em> and
writable for you and your group.</p><p>In order to protect your keys from accidental damage, you will want to remove their
write permissions. To make them only readable by you, change file modes as follows:</p><pre class="language-text"><code>chmod -v 0400 ca-key.pem key.pem server-key.pem
</code></pre><p>Certificates can be world-readable, but you might want to remove write access to
prevent accidental damage:</p><pre class="language-text"><code>chmod -v 0444 ca.pem server-cert.pem cert.pem
</code></pre><p>Now you can make the Docker daemon only accept connections from clients
providing a certificate trusted by our CA.</p></div><div class="content edit-link"><a href="https://github.com/axibase/axibase-collector/edit/master//jobs/docker-certificates.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div></div></div>
    <script src="/axibase-collector/assets/js/101.0ed2a672.js" defer></script><script src="/axibase-collector/assets/js/app.ba8ff567.js" defer></script>
  </body>
</html>
