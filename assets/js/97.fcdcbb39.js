(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{216:function(e,t,r){e.exports=r.p+"assets/img/docker-remote.cd26fdd3.png"},217:function(e,t,r){e.exports=r.p+"assets/img/docker-local.18937084.png"},244:function(e,t,r){"use strict";r.r(t);var s=[function(){var e=this.$createElement,t=this._self._c||e;return t("h1",{attrs:{id:"docker-job"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-job","aria-hidden":"true"}},[this._v("#")]),this._v(" Docker Job")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"overview"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#overview","aria-hidden":"true"}},[this._v("#")]),this._v(" Overview")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("The Docker Job collects container statistics, states, and events from Docker daemons via the "),t("a",{attrs:{href:"https://docs.docker.com/engine/reference/api/docker_remote_api/",target:"_blank",rel:"noopener noreferrer"}},[this._v("Docker Engine Remote API")]),this._v(".")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("Host")]),t("li",[this._v("Image")]),t("li",[this._v("Container")]),t("li",[this._v("Volume")]),t("li",[this._v("Network")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"job-settings"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#job-settings","aria-hidden":"true"}},[this._v("#")]),this._v(" Job Settings")])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("table",[r("thead",[r("tr",[r("th",[r("strong",[e._v("Name")])]),r("th",[r("strong",[e._v("Description")])])])]),r("tbody",[r("tr",[r("td",[r("code",[e._v("API Version")])]),r("td",[e._v("API version used when querying the Docker Engine API. Defaults to 'latest'. "),r("br"),e._v("Can be set to a specific version to ensure compatibility.")])]),r("tr",[r("td",[r("code",[e._v("Lifecycle Event Monitoring")])]),r("td",[e._v("Enables continuous monitoring of container lifecycle events instead of scheduled polling.")])]),r("tr",[r("td",[r("code",[e._v("Property Interval")]),e._v(", minutes")]),r("td",[e._v("Interval for refreshing detailed image and container properties.")])]),r("tr",[r("td",[r("code",[e._v("Statistics Interval")]),e._v(", seconds")]),r("td",[e._v("Interval at which utilization statistics from running containers are collected.")])]),r("tr",[r("td",[r("code",[e._v("Process Interval")]),e._v(", minutes")]),r("td",[e._v("Interval at which top process list is collected from running docker containers.")])]),r("tr",[r("td",[r("code",[e._v("Excluded Processes")])]),r("td",[e._v("Lists processes, separated by comma, to exclude from collection. Expressions support the wildcard option (*).")])]),r("tr",[r("td",[r("code",[e._v("Environment Tags")])]),r("td",[e._v("List of ENV variables stored as entity tags.")])])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"prerequisites"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites","aria-hidden":"true"}},[this._v("#")]),this._v(" Prerequisites")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/installation/",target:"_blank",rel:"noopener noreferrer"}},[this._v("Docker Engine v1.7+")])]),t("li",[t("a",{attrs:{href:"https://axibase.com/docs/atsd/installation/docker.html",target:"_blank",rel:"noopener noreferrer"}},[this._v("Axibase Time Series Database")]),this._v(" container as a centralized metrics store and rule engine.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"local-installation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#local-installation","aria-hidden":"true"}},[this._v("#")]),this._v(" Local Installation")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("In local collection mode, Axibase Collector containers run on each Docker host and gather statistics locally from the Docker engine API exposed at the "),t("a",{attrs:{href:"https://docs.docker.com/engine/reference/api/docker_remote_api/",target:"_blank",rel:"noopener noreferrer"}},[this._v("/var/run/docker.sock")]),this._v(" Unix socket.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("img",{attrs:{src:r(217),alt:"Local Collection"}})])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ul",[r("li",[e._v("Create a "),r("a",{attrs:{href:"https://axibase.com/docs/atsd/administration/collector-rw-account.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("collector account")]),e._v(" in ATSD.")]),r("li",[e._v("Replace "),r("code",[e._v("atsd_host")]),e._v(" and "),r("code",[e._v("atsd_https_port")]),e._v(" with the ATSD hostname/IP address and https port (default 8443).")]),r("li",[e._v("Replace "),r("code",[e._v("collector-rw")]),e._v(" and "),r("code",[e._v("collector-password")]),e._v(" with valid credentials in the script below.")]),r("li",[e._v("Start Axibase Collector container:")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{attrs:{class:"token attr-name"}},[this._v("docker")]),this._v(" "),t("span",{attrs:{class:"token attr-value"}},[this._v("run \\\n   --detach \\\n   --publish-all \\\n   --restart=always \\\n   --name=axibase-collector \\\n   --volume /var/run/docker.sock:/var/run/docker.sock \\\n   --env=DOCKER_HOSTNAME=`hostname -f` \\\n  axibase/collector \\\n   -atsd-url=https://collector-rw:collector-password@atsd_host:atsd_https_port \\\n   -job-enable=docker-socket")]),this._v("\n")])])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("p",[e._v("If the user name or password contains "),r("code",[e._v("$")]),e._v(", "),r("code",[e._v("&")]),e._v(", "),r("code",[e._v("#")]),e._v(", or "),r("code",[e._v("!")]),e._v(" character, escape it with backslash "),r("code",[e._v("\\")]),e._v(".")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("The password must contain at least "),t("strong",[this._v("six")]),this._v(" (6) characters and is subject to the following "),t("a",{attrs:{href:"https://axibase.com/docs/atsd/administration/user-authentication.html#password-requirements",target:"_blank",rel:"noopener noreferrer"}},[this._v("requirements")]),this._v(".")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("For example, for user "),t("code",[this._v("adm-dev")]),this._v(" with password "),t("code",[this._v("my$pwd")]),this._v(" sending data to ATSD at "),t("code",[this._v("https://10.102.0.6:8443")]),this._v(" specify:")])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{attrs:{class:"token attr-name"}},[this._v("docker")]),this._v(" "),t("span",{attrs:{class:"token attr-value"}},[this._v("run \\\n   --detach \\\n   --publish-all \\\n   --restart=always \\\n   --name=axibase-collector \\\n   --volume /var/run/docker.sock:/var/run/docker.sock \\\n   --env=DOCKER_HOSTNAME=`hostname -f` \\\n  axibase/collector \\\n   -atsd-url=https://adm-dev:my\\$pwd@10.102.0.6:8443 \\\n   -job-enable=docker-socket")]),this._v("\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"selinux"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#selinux","aria-hidden":"true"}},[this._v("#")]),this._v(" SELinux")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("On Docker hosts with SELinux enabled in enforced mode, the container will run into a "),t("code",[this._v("permission denied")]),this._v(" error when trying to read data from  "),t("code",[this._v("/var/run/docker.sock")]),this._v(".")])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ul",[r("li",[r("p",[e._v("Run container in privileged mode ("),r("code",[e._v("--privileged")]),e._v(")")])]),r("li",[r("p",[e._v("Run container with disabled security labeling ("),r("code",[e._v("--security-opt label=disable")]),e._v(")")])]),r("li",[r("p",[e._v("Disable SELinux or set it into logging mode with "),r("code",[e._v("sudo setenforce Permissive")])])]),r("li",[r("p",[e._v("Other alternatives using "),r("a",{attrs:{href:"https://github.com/dpw/selinux-dockersock",target:"_blank",rel:"noopener noreferrer"}},[r("code",[e._v("semodule")])])])]),r("li",[r("p",[r("strong",[e._v("Launch Parameters")])])])])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("table",[r("thead",[r("tr",[r("th",[r("strong",[e._v("Name")])]),r("th",[r("strong",[e._v("Required")])]),r("th",[r("strong",[e._v("Description")])])])]),r("tbody",[r("tr",[r("td",[r("code",[e._v("--detach")])]),r("td",[e._v("Yes")]),r("td",[e._v("Run container in background and print container id.")])]),r("tr",[r("td",[r("code",[e._v("--name")])]),r("td",[e._v("No")]),r("td",[e._v("Assign a host-unique name to the container.")])]),r("tr",[r("td",[r("code",[e._v("--restart")])]),r("td",[e._v("No")]),r("td",[e._v("Auto-restart policy. "),r("em",[e._v("Not supported in all Docker Engine versions.")])])]),r("tr",[r("td",[r("code",[e._v("--publish-all")])]),r("td",[e._v("No")]),r("td",[e._v("Publish all exposed ports to random ports.")])]),r("tr",[r("td",[r("code",[e._v("--env")])]),r("td",[e._v("No")]),r("td",[e._v("Set environment variables.")])])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"remote-collection"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#remote-collection","aria-hidden":"true"}},[this._v("#")]),this._v(" Remote Collection")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[t("img",{attrs:{src:r(216),alt:"Local Collection"}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"enable-remote-api-access-on-docker-hosts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#enable-remote-api-access-on-docker-hosts","aria-hidden":"true"}},[this._v("#")]),this._v(" Enable Remote API Access on Docker Hosts")])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("li",[r("p",[e._v("Configure the Docker daemon for secure access over HTTPS.")]),r("p",[r("strong",[e._v("On Ubuntu 14.04")])]),r("ul",[r("li",[r("p",[e._v("Edit the "),r("code",[e._v("/etc/default/docker")]),e._v(" file")]),r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('# Set path to the folder containing {ca,server-cert,server-key}.pem files\nDOCKER_CERT_PATH=/home/user/certs\nexport DOCKER_CERT_PATH\n\n# Add TCP socket on port 2376\nDOCKER_OPTS="--tlsverify --tlscacert=$DOCKER_CERT_PATH/ca.pem --tlscert=$DOCKER_CERT_PATH/server-cert.pem --tlskey=$DOCKER_CERT_PATH/server-key.pem -H unix:///var/run/docker.sock -H tcp://0.0.0.0:2376"\n')])])]),r("li",[r("p",[e._v("Restart the Docker daemon.")]),r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("sudo service docker restart\n")])])])])])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("li",[r("p",[r("strong",[e._v("On Ubuntu 16.04, Centos 7.x and RHEL 7.x")])]),r("ul",[r("li",[r("p",[e._v("Create new socket unit.")]),r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("echo <<EOF > /lib/sytemd/system/docker-tcp.socket\n[Unit]\nDescription=Docker TCP Socket for the API\n\n[Socket]\nListenStream=2376\nService=docker.service\n\n[Install]\nWantedBy=sockets.target\nEOF\n")])])]),r("li",[r("p",[e._v("Edit "),r("code",[e._v("/etc/docker/daemon.json")]),e._v(" file by adding the options below. Replace "),r("code",[e._v("/home/user/certs")]),e._v(" with absolute path of previously created "),r("code",[e._v("certs")]),e._v(" directory.")]),r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v('{\n  ...,\n  "tlscacert": "/home/user/certs/ca.pem",\n  "tlscert": "/home/user/certs/server-cert.pem",\n  "tlskey": "/home/user/certs/server-key.pem",\n  "tlsverify": true\n}\n')])])]),r("li",[r("p",[e._v("Stop the Docker daemon and activate the socket.")]),r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("systemctl enable docker-tcp.socket\nsystemctl stop docker\nsystemctl start docker-tcp.socket\n")])])]),r("li",[r("p",[e._v("Check that the socket has been successfully activated.")]),r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("systemctl status docker-tcp.socket\n")])]),r("p",[e._v("Output example:")]),r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("● docker-tcp.socket - Docker TCP Socket for the API\n  Loaded: loaded (/lib/systemd/system/docker-tcp.socket; enabled; vendor preset: enabled)\n  Active: active (running) since Sat 2018-03-03 18:54:32 CET; 2min ago\n  Listen: [::]:2376 (Stream)\n\nMar 03 18:54:32 localhost systemd[1]: Listening on Docker TCP Socket for the API.\n")])])]),r("li",[r("p",[e._v("Start the Docker daemon.")]),r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("systemctl start docker\n")])])]),r("li",[r("p",[e._v("Ensure that the Docker daemon status is "),r("em",[e._v("active")]),e._v(" and there are no warnings.")]),r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("systemctl status docker\n")])])])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("p",[this._v("Verify connectivity.")]),t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("curl https://127.0.0.1:2376/info     \\\n    --cert /home/user/certs/cert.pem \\\n    --key /home/user/certs/key.pem   \\\n    --cacert /home/user/certs/ca.pem\n")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("p",[this._v("Copy the "),t("code",[this._v("{ca,cert,key}.pem")]),this._v(" files to your machine.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h3",{attrs:{id:"launch-axibase-collector-container"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#launch-axibase-collector-container","aria-hidden":"true"}},[this._v("#")]),this._v(" Launch Axibase Collector Container")])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ul",[r("li",[r("p",[e._v("Create a "),r("a",{attrs:{href:"https://axibase.com/docs/atsd/administration/collector-rw-account.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("collector account")]),e._v(" in ATSD.")])]),r("li",[r("p",[e._v("Start Axibase Collector container, replacing "),r("code",[e._v("collector-rw")]),e._v(" and "),r("code",[e._v("collector-password")]),e._v(" with valid credentials:")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{attrs:{class:"token attr-name"}},[this._v("docker")]),this._v(" "),t("span",{attrs:{class:"token attr-value"}},[this._v("run \\\n   --detach \\\n   --publish-all \\\n   --name=axibase-collector \\\n  axibase/collector \\\n   -atsd-url=https://collector-rw:collector-password@atsd_host:atsd_https_port")]),this._v("\n")])])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("p",[e._v("If the user name or password contains a "),r("code",[e._v("$")]),e._v(", "),r("code",[e._v("&")]),e._v(", "),r("code",[e._v("#")]),e._v(", or "),r("code",[e._v("!")]),e._v(" character, escape it with backslash "),r("code",[e._v("\\")]),e._v(".")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("The password must contain at least "),t("strong",[this._v("6")]),this._v(" characters and is subject to the following "),t("a",{attrs:{href:"https://axibase.com/docs/atsd/administration/user-authentication.html#password-requirements",target:"_blank",rel:"noopener noreferrer"}},[this._v("requirements")]),this._v(".")])},function(){var e=this.$createElement,t=this._self._c||e;return t("ul",[t("li",[this._v("Find the https port assigned to the "),t("code",[this._v("axibase-collector")]),this._v(" container.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("docker ps -a | grep axibase-collector\n")])])},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ul",[r("li",[e._v("Log in to the Axibase Collector web interface at "),r("code",[e._v("https://hostname:port")]),e._v(".")]),r("li",[e._v("Open the "),r("strong",[e._v("Jobs > Docker > Add Job")]),e._v(" page and enter the job name. Click "),r("strong",[e._v("Enabled")]),e._v(" to enable the job. Click Save.")]),r("li",[e._v("Click the [Use Wizard] button, specify the Docker Engine hostname, API port (2376), and attach "),r("code",[e._v("{cert,key,ca}.pem")]),e._v(" files.")]),r("li",[e._v("Click Validate and then Save if the test is successful.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"validation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#validation","aria-hidden":"true"}},[this._v("#")]),this._v(" Validation")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("If the Docker host is missing in ATSD, open the 'Jobs' page in Collector, check the "),t("strong",[this._v("Result")]),this._v(" column, and review the "),t("strong",[this._v("Execution Details")]),this._v(" page for any errors.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"container-launch-troubleshooting"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#container-launch-troubleshooting","aria-hidden":"true"}},[this._v("#")]),this._v(" Container Launch Troubleshooting")])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("docker exec -it axibase-collector tail -f /opt/axibase-collector/logs/axibase-collector.log\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("blockquote",[t("p",[this._v("FrameworkServlet 'dispatcher': initialization completed.")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"ui"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ui","aria-hidden":"true"}},[this._v("#")]),this._v(" UI")])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Verify the https port that is assigned to the collector and open it in your browser: "),t("code",[this._v("https://container-ip:port")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[this._v("docker ps | grep axibase-collector\n")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("p",[this._v("Locate the "),t("strong",[this._v("docker-socket")]),this._v(" job on the 'Jobs' list and verify that it is enabled and that the "),t("code",[this._v("Items Read")]),this._v(" column is not 0.")])},function(){var e=this.$createElement,t=this._self._c||e;return t("h2",{attrs:{id:"testing-and-evaluating"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#testing-and-evaluating","aria-hidden":"true"}},[this._v("#")]),this._v(" Testing and Evaluating")])}],a=r(0),n=Object(a.a)({},function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"content"},[e._m(0),e._m(1),e._m(2),r("p",[e._v("Information is collected for the following object types:")]),e._m(3),e._m(4),e._m(5),e._m(6),e._m(7),e._m(8),e._m(9),e._m(10),e._m(11),e._m(12),e._m(13),e._m(14),e._m(15),e._m(16),r("p",[e._v("It may take up to 5 minutes to initialize the Collector's database upon initial startup.")]),r("p",[e._v("The Docker job should start executing immediately.")]),e._m(17),e._m(18),r("p",[e._v("Switch to the Remote Collection option or follow one of the following steps to address it:")]),e._m(19),e._m(20),e._m(21),r("p",[e._v("In remote collection mode Axibase Collector fetches data from multiple remote Docker hosts using https protocol.")]),e._m(22),e._m(23),r("ul",[r("li",[r("p",[e._v("Log in to the Docker host via SSH and generate "),r("router-link",{attrs:{to:"docker-certificates.html"}},[e._v("client and server certificates")]),e._v(".")],1)]),e._m(24),e._m(25),e._m(26),e._m(27)]),e._m(28),e._m(29),e._m(30),e._m(31),e._m(32),e._m(33),e._m(34),e._m(35),e._m(36),r("p",[e._v("Log in to ATSD and verify that connected Docker hosts are displayed on the 'Entities: Docker Hosts' page.")]),e._m(37),e._m(38),e._m(39),r("p",[e._v("The following message indicates that the initial configuration is finished:")]),e._m(40),e._m(41),e._m(42),e._m(43),e._m(44),e._m(45),r("p",[e._v("You can launch both the "),r("strong",[e._v("atsd")]),e._v(" and "),r("strong",[e._v("axibase-collector")]),e._v(" containers in a "),r("router-link",{attrs:{to:"docker-compose.html"}},[e._v("test environment")]),e._v(" using  "),r("code",[e._v("docker-compose")]),e._v(".")],1)])},s,!1,null,null,null);t.default=n.exports}}]);