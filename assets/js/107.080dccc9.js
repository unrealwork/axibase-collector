(window.webpackJsonp=window.webpackJsonp||[]).push([[107],{267:function(t,e,a){"use strict";a.r(e);var s=a(0),n=Object(s.a)({},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[t._m(0),t._m(1),t._m(2),t._m(3),t._m(4),t._m(5),t._m(6),t._m(7),t._m(8),t._m(9),t._m(10),a("p",[t._v("Notes:")]),t._m(11),t._m(12),t._m(13),t._m(14),t._m(15),t._m(16),t._m(17),t._m(18),t._m(19),a("p",[t._v("The service type is specified as "),a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport",target:"_blank",rel:"noopener noreferrer"}},[t._v("NodePort")]),t._v(", whereas each node will redirect traffic to the atsd service on the same port.\nThe Service automatically creates environment variables, which are "),a("router-link",{attrs:{to:"installation-on-docker.html#environment-variables"}},[t._v("supported by Collector")]),t._v(":")],1),t._m(20),t._m(21),t._m(22),t._m(23),t._m(24),t._m(25),t._m(26),t._m(27),a("p",[t._v("Notes:")]),t._m(28),t._m(29),t._m(30),t._m(31),t._m(32),t._m(33),t._m(34),t._m(35),t._m(36),t._m(37),t._m(38),t._m(39)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"installation-on-kubernetes-cluster"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#installation-on-kubernetes-cluster","aria-hidden":"true"}},[this._v("#")]),this._v(" Installation on Kubernetes Cluster")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"create-secrets"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-secrets","aria-hidden":"true"}},[this._v("#")]),this._v(" Create secrets")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Create a "),e("a",{attrs:{href:"https://kubernetes.io/docs/concepts/configuration/secret/#creating-your-own-secrets",target:"_blank",rel:"noopener noreferrer"}},[this._v("secret object")]),this._v(" for the ATSD "),e("a",{attrs:{href:"https://axibase.com/docs/atsd/administration/collector-account.html",target:"_blank",rel:"noopener noreferrer"}},[this._v("collector user")]),this._v(". This account will be used by collector instances to transmit metrics securely into the database.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Create a "),e("a",{attrs:{href:"https://kubernetes.io/docs/concepts/configuration/secret/#creating-a-secret-manually",target:"_blank",rel:"noopener noreferrer"}},[e("code",[this._v("secret.yaml")])]),this._v(" file with the "),e("a",{attrs:{href:"./files/secret.yaml"}},[this._v("following content")]),this._v(":")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Secret\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" axibase\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Opaque\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("data")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("collector-pass")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MTIzNDU2Nzg5MA==\n")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Create the secret using the "),e("a",{attrs:{href:"https://kubernetes.io/docs/user-guide/kubectl/v1.8/#create",target:"_blank",rel:"noopener noreferrer"}},[e("code",[this._v("kubectl create")])]),this._v(" command:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('$ kubectl create -f ./secret.yaml\nsecret "axibase" created\n')])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"install-atsd"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#install-atsd","aria-hidden":"true"}},[this._v("#")]),this._v(" Install ATSD")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"create-atsd-deployment"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-atsd-deployment","aria-hidden":"true"}},[this._v("#")]),this._v(" Create ATSD Deployment")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Create a "),e("a",{attrs:{href:"https://kubernetes.io/docs/concepts/workloads/controllers/deployment",target:"_blank",rel:"noopener noreferrer"}},[this._v("deployment object")]),this._v(" for ATSD configured using the following "),e("a",{attrs:{href:"./files/atsd-deployment.yaml"}},[e("code",[this._v("atsd-deployment.yaml")])]),this._v(" file as an example.")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1beta1\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" atsd\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" atsd\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("tier")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deployment\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" atsd\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("strategy")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Recreate\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" atsd\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" axibase/atsd"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n        "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" atsd\n        "),a("span",{attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" COLLECTOR_USER_TYPE\n          "),a("span",{attrs:{class:"token key atrule"}},[t._v("value")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" api"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("rw\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" COLLECTOR_USER_NAME\n          "),a("span",{attrs:{class:"token key atrule"}},[t._v("value")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" collector\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" COLLECTOR_USER_PASSWORD\n          "),a("span",{attrs:{class:"token key atrule"}},[t._v("valueFrom")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{attrs:{class:"token key atrule"}},[t._v("secretKeyRef")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" axibase\n              "),a("span",{attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" collector"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pass\n        "),a("span",{attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("8081")]),t._v("\n          "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tcp\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("8443")]),t._v("\n          "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https\n        "),a("span",{attrs:{class:"token key atrule"}},[t._v("resources")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{attrs:{class:"token key atrule"}},[t._v("requests")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{attrs:{class:"token key atrule"}},[t._v("memory")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"600Mi"')]),t._v("\n          "),a("span",{attrs:{class:"token key atrule"}},[t._v("limits")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{attrs:{class:"token key atrule"}},[t._v("memory")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"1200Mi"')]),t._v("\n\n")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",[a("li",[a("code",[t._v("atsd")]),t._v(" deployment is defined in "),a("code",[t._v("metadata: name")]),t._v(" field.")]),a("li",[t._v("The deployment consists of one pod.")]),a("li",[t._v("The "),a("code",[t._v("selector")]),t._v(" field defines how the deployment finds pods to be managed. In this case, we simply select a pod based on the label defined in the Pod template ("),a("code",[t._v("app: atsd")]),t._v(").")]),a("li",[t._v("The pod template’s specification, or "),a("code",[t._v("template: spec")]),t._v(" field, indicates that the Pod should run one container, named "),a("code",[t._v("atsd")]),t._v(", which runs the latest "),a("a",{attrs:{href:"https://hub.docker.com/r/axibase/atsd/",target:"_blank",rel:"noopener noreferrer"}},[t._v("atsd")]),t._v(" image from Docker Hub.")]),a("li",[t._v("The deployment opens ports 8081 and 8443.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The "),e("code",[this._v("template")]),this._v(" field contains the following instructions for the pod:")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",[a("li",[t._v("Add label "),a("code",[t._v("app: atsd")]),t._v(" to the container.")]),a("li",[t._v("Create one container and name it "),a("code",[t._v("atsd")]),t._v(".")]),a("li",[t._v("Run a container from the latest "),a("code",[t._v("axibase/atsd")]),t._v(" image.")]),a("li",[t._v("The container should use "),a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/configuration/secret/#using-secrets-as-environment-variables",target:"_blank",rel:"noopener noreferrer"}},[t._v("secrets as environment variables")]),t._v(", indicated by "),a("code",[t._v("valueFrom.secretKeyRef")]),t._v(" field.")]),a("li",[t._v("The container has a memory request of 600 MiB and a memory limit of 1200 MiB.")]),a("li",[t._v("Open ports 8081 and 8443 to accept incoming TCP traffic.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Create the deployment using the "),e("a",{attrs:{href:"https://kubernetes.io/docs/user-guide/kubectl/v1.8/#create",target:"_blank",rel:"noopener noreferrer"}},[this._v("kubectl create")]),this._v(" command:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('$ kubectl create -f ./atsd-deployment.yaml\ndeployment "atsd" created\n')])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"create-atsd-service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-atsd-service","aria-hidden":"true"}},[this._v("#")]),this._v(" Create ATSD Service")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Create a "),e("a",{attrs:{href:"https://kubernetes.io/docs/concepts/services-networking/service/",target:"_blank",rel:"noopener noreferrer"}},[this._v("service object")]),this._v(" for ATSD using "),e("a",{attrs:{href:"./files/atsd-service.yaml"}},[e("code",[this._v("atsd-service.yaml")])]),this._v(" file with the following content:")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" atsd\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" atsd\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("tier")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("protocol")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("8081")]),t._v("\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("nodePort")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("30081")]),t._v("\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tcp\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("protocol")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("8443")]),t._v("\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("nodePort")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("30443")]),t._v("\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" atsd\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" NodePort\n")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("This specification will create a new Service object named "),e("code",[this._v("atsd")]),this._v(" which opens TCP ports on any Pod with the "),e("code",[this._v("app=atsd")]),this._v(" label.")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",[a("li",[a("p",[t._v("ATSD_SERVICE_HOST (variable pattern '{service_name}_SERVICE_HOST')")])]),a("li",[a("p",[t._v("ATSD_SERVICE_PORT_HTTPS (variable pattern '{service_name}_SERVICE_PORT_{port_name}'), specified by the "),a("code",[t._v("spec.ports")]),t._v(" field:")]),a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("protocol")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("8443")]),t._v("\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https\n")])])]),a("li",[a("p",[t._v("ATSD_SERVICE_PORT_TCP (variable pattern '{service_name}_SERVICE_PORT_{port_name}'), specified by the "),a("code",[t._v("spec.ports")]),t._v(" field:")]),a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("protocol")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("8081")]),t._v("\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" tcp\n")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Create the service using the "),e("a",{attrs:{href:"https://kubernetes.io/docs/user-guide/kubectl/v1.8/#create",target:"_blank",rel:"noopener noreferrer"}},[this._v("kubectl create")]),this._v(" command:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('$ kubectl create -f ./atsd-service.yaml\nservice "atsd" created\n')])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("Note")]),this._v(" When using type "),e("a",{attrs:{href:"https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport",target:"_blank",rel:"noopener noreferrer"}},[this._v("NodePort")]),this._v(", the firewall is not opened by default. You need to add firewall rules to allow access for ports, indicated in the "),e("code",[this._v("nodePort:")]),this._v(" field.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"install-collector"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#install-collector","aria-hidden":"true"}},[this._v("#")]),this._v(" Install Collector")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"create-collector-deployment"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#create-collector-deployment","aria-hidden":"true"}},[this._v("#")]),this._v(" Create Collector Deployment")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Create a "),e("a",{attrs:{href:"https://kubernetes.io/docs/concepts/workloads/controllers/deployment",target:"_blank",rel:"noopener noreferrer"}},[this._v("deployment object")]),this._v(" for Axibase Collector using "),e("a",{attrs:{href:"./files/collector-deployment.yaml"}},[e("code",[this._v("collector-deployement.yaml")])]),this._v(" file:")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1beta1\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" axibase"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("collector\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" axibase"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("collector\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("tier")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" deployment\n"),a("span",{attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("3")]),t._v("\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" axibase"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("collector\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("strategy")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Recreate\n  "),a("span",{attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" axibase"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("collector\n    "),a("span",{attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("affinity")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{attrs:{class:"token key atrule"}},[t._v("podAntiAffinity")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{attrs:{class:"token key atrule"}},[t._v("requiredDuringSchedulingIgnoredDuringExecution")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("labelSelector")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n             "),a("span",{attrs:{class:"token key atrule"}},[t._v("matchExpressions")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n             "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" app\n               "),a("span",{attrs:{class:"token key atrule"}},[t._v("operator")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" In\n               "),a("span",{attrs:{class:"token key atrule"}},[t._v("values")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n               "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" axibase"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("collector\n            "),a("span",{attrs:{class:"token key atrule"}},[t._v("topologyKey")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes.io/hostname\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" axibase/collector"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n        "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" axibase"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("collector\n        "),a("span",{attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" COLLECTOR_USER_NAME\n          "),a("span",{attrs:{class:"token key atrule"}},[t._v("value")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" collector\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" COLLECTOR_USER_PASSWORD\n          "),a("span",{attrs:{class:"token key atrule"}},[t._v("valueFrom")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{attrs:{class:"token key atrule"}},[t._v("secretKeyRef")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" axibase\n              "),a("span",{attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" collector"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pass\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" JAVA_OPTS\n          "),a("span",{attrs:{class:"token key atrule"}},[t._v("value")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"-Xmx512m"')]),t._v("\n        "),a("span",{attrs:{class:"token key atrule"}},[t._v("args")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v('"-job-enable=docker-socket"')]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),a("span",{attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("9443")]),t._v("\n          "),a("span",{attrs:{class:"token key atrule"}},[t._v("hostPort")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("9443")]),t._v("\n          "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https\n        "),a("span",{attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("socket\n          "),a("span",{attrs:{class:"token key atrule"}},[t._v("mountPath")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/run/docker.sock\n        "),a("span",{attrs:{class:"token key atrule"}},[t._v("resources")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{attrs:{class:"token key atrule"}},[t._v("requests")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{attrs:{class:"token key atrule"}},[t._v("memory")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"200Mi"')]),t._v("\n          "),a("span",{attrs:{class:"token key atrule"}},[t._v("limits")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{attrs:{class:"token key atrule"}},[t._v("memory")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"600Mi"')]),t._v("\n      "),a("span",{attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker"),a("span",{attrs:{class:"token punctuation"}},[t._v("-")]),t._v("socket\n        "),a("span",{attrs:{class:"token key atrule"}},[t._v("hostPath")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{attrs:{class:"token key atrule"}},[t._v("path")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/run/docker.sock\n")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",[a("li",[a("code",[t._v("axibase-collector")]),t._v(" deployment is defined in "),a("code",[t._v("metadata: name")]),t._v(" field.")]),a("li",[t._v("The Deployment creates "),a("strong",[t._v("three")]),t._v(" replicated Pods, indicated by the "),a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#replicas",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("replicas")])]),t._v(" field. If you want to install the Collector on each node, the replicas value must be equal node count.")]),a("li",[t._v("The "),a("code",[t._v("selector")]),t._v(" field defines how the deployment finds pods to be managed. In this case, we select a pod based on the label defined in the Pod template ("),a("code",[t._v("app: axibase-collector")]),t._v(").")]),a("li",[t._v("The pod template’s specification, or "),a("code",[t._v("template: spec")]),t._v(" field, indicates that the Pod should run one container, named "),a("code",[t._v("axibase-collector")]),t._v(", which runs the latest "),a("a",{attrs:{href:"https://hub.docker.com/r/axibase/collector/",target:"_blank",rel:"noopener noreferrer"}},[t._v("axibase-collector")]),t._v(" image from Docker Hub.")]),a("li",[t._v("The deployment opens port 9443.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("The "),e("code",[this._v("template")]),this._v(" field contains the following instructions:")])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",[a("li",[t._v("Add label "),a("code",[t._v("app: axibase-collector")]),t._v(" to each pod.")]),a("li",[t._v("Pods use "),a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("affinity")])]),t._v(". We have "),a("code",[t._v("podAntiAffinity")]),t._v(" that will restrict to have two same pods (label "),a("code",[t._v("app:axibase-collector")]),t._v(") in one node.")]),a("li",[t._v("Create one container and name it "),a("code",[t._v("axibase-collector")]),t._v(".")]),a("li",[t._v("Create one volume and name it "),a("code",[t._v("docker-socket")]),t._v(".")]),a("li",[t._v("Run the "),a("code",[t._v("axibase/collector")]),t._v(" image at latest version.")]),a("li",[t._v("The container uses "),a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/configuration/secret/#using-secrets-as-environment-variables",target:"_blank",rel:"noopener noreferrer"}},[t._v("secrets as environment variables")]),t._v(", indicated by "),a("code",[t._v("valueFrom.secretKeyRef")]),t._v(" field.")]),a("li",[t._v("The container has a memory request of 200 MiB and a memory limit of 600 MiB.")]),a("li",[t._v("The container uses the "),a("code",[t._v("docker-socket")]),t._v(" volume, indicated by the "),a("code",[t._v("volumeMounts")]),t._v(" field.")]),a("li",[t._v("Open ports 9443 so that the container can send and accept traffic. The port is also opened on each Node, specified by the "),a("code",[t._v("hostPort: 9443")]),t._v(" field.")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Create the deployment using the "),e("a",{attrs:{href:"https://kubernetes.io/docs/user-guide/kubectl/v1.8/#create",target:"_blank",rel:"noopener noreferrer"}},[this._v("kubectl create")]),this._v(" command:")])},function(){var t=this.$createElement,e=this._self._c||t;return e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('$ kubectl create -f ./collector-deployment.yaml\ndeployment "axibase-collector" created\n')])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"verify-installation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#verify-installation","aria-hidden":"true"}},[this._v("#")]),this._v(" Verify Installation")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("View deployments using "),e("a",{attrs:{href:"https://kubernetes.io/docs/user-guide/kubectl/v1.8/#get",target:"_blank",rel:"noopener noreferrer"}},[this._v("kubectl get")]),this._v(":")])},function(){var t=this.$createElement,e=this._self._c||t;return e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ kubectl get deploy -o wide\nNAME                DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE       CONTAINERS          IMAGES                     SELECTOR\natsd                1         1         1            1           2d        atsd                axibase/atsd:latest        app=atsd\naxibase-collector   3         3         3            3           2d        axibase-collector   axibase/collector:latest   app=axibase-collector\n")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("View pods using "),e("a",{attrs:{href:"https://kubernetes.io/docs/user-guide/kubectl/v1.8/#get",target:"_blank",rel:"noopener noreferrer"}},[this._v("kubectl get")]),this._v(":")])},function(){var t=this.$createElement,e=this._self._c||t;return e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ kubectl get pod -o wide\nNAME                                 READY     STATUS    RESTARTS   AGE       IP          NODE\natsd-1742852640-vvzlk                1/1       Running   0          2d        10.8.0.14   gke-cluster-1-default-pool-fcd89b74-bstn\naxibase-collector-2747957227-03dj2   1/1       Running   0          2d        10.8.2.8    gke-cluster-1-default-pool-fcd89b74-96gq\naxibase-collector-2747957227-5hr0g   1/1       Running   0          2d        10.8.0.15   gke-cluster-1-default-pool-fcd89b74-bstn\naxibase-collector-2747957227-whd99   1/1       Running   0          2d        10.8.1.8    gke-cluster-1-default-pool-fcd89b74-ln58\n")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("View services using "),e("a",{attrs:{href:"https://kubernetes.io/docs/user-guide/kubectl/v1.8/#get",target:"_blank",rel:"noopener noreferrer"}},[this._v("kubectl get")]),this._v(":")])},function(){var t=this.$createElement,e=this._self._c||t;return e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("$ kubectl get service -o wide\nNAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                         AGE       SELECTOR\natsd         NodePort    10.11.241.144   <none>        8081:30081/TCP,8443:30443/TCP   3d        app=atsd\nkubernetes   ClusterIP   10.11.240.1     <none>        443/TCP                         3d        <none>\n")])])}],!1,null,null,null);e.default=n.exports}}]);